<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>GNPS spectrum similarity scores — gnps • MsCoreUtils</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="GNPS spectrum similarity scores — gnps" />
<meta property="og:description" content="The join_gnps and gnps functions allow to calculate spectra similarity
scores as used in GNPS. The approach matches first
peaks between the two spectra directly using a user-defined ppm and/or
tolerance as well as using a fixed delta m/z (considering the same ppm and
tolerance) that is defined by the difference of the two spectras' precursor
m/z values. For peaks that match multiple peaks in the
other spectrum only the matching peak pair with the higher value/similarity
is considered in the final similarity score calculation. Note that GNPS
similarity scores are calculated only if the two functions are used together.
join_gnps: matches/maps peaks between spectra with the same approach
as in GNPS: peaks are considered matching if a) the
difference in their m/z values is smaller than defined by tolerance
and ppm (this is the same as joinPeaks) and b) the difference of
their m/z adjusted for the difference of the spectras' precursor is
smaller than defined by tolerance and ppm. Based on this definition,
peaks in x can match up to two peaks in y hence returned peak indices
might be duplicated. Note that if one of xPrecursorMz or yPrecursorMz
are NA or if both are the same, the results are the same as with
join(). The function returns a list of two integer vectors with the
indices of the peaks matching peaks in the other spectrum or NA
otherwise.
gnps: calculates the GNPS similarity score on peak matrices' previously
aligned (matched) with join_gnps. For multi-mapping peaks the pair with
the higher similarity are considered in the final score calculation.

" />
<meta property="og:image" content="/logo.png" />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->




  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MsCoreUtils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/MsCoreUtils.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/RforMassSpectrometry/MsCoreUtils/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>GNPS spectrum similarity scores</h1>
    <small class="dont-index">Source: <a href='https://github.com/RforMassSpectrometry/MsCoreUtils/blob/master/R/gnps.R'><code>R/gnps.R</code></a></small>
    <div class="hidden name"><code>gnps.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The <code>join_gnps</code> and <code>gnps</code> functions allow to calculate spectra similarity
scores as used in <a href='https://gnps.ucsd.edu/'>GNPS</a>. The approach matches first
peaks between the two spectra directly using a user-defined ppm and/or
tolerance as well as using a fixed delta m/z (considering the same ppm and
tolerance) that is defined by the difference of the two spectras' precursor
m/z values. For peaks that match multiple peaks in the
other spectrum only the matching peak pair with the higher value/similarity
is considered in the final similarity score calculation. Note that GNPS
similarity scores are calculated only if the two functions are used together.</p><ul>
<li><p><code>join_gnps</code>: matches/maps peaks between spectra with the same approach
as in GNPS: peaks are considered matching if a) the
difference in their m/z values is smaller than defined by <code>tolerance</code>
and <code>ppm</code> (this is the same as <code>joinPeaks</code>) <strong>and</strong> b) the difference of
their m/z <em>adjusted</em> for the difference of the spectras' precursor is
smaller than defined by <code>tolerance</code> and <code>ppm</code>. Based on this definition,
peaks in <code>x</code> can match up to two peaks in <code>y</code> hence returned peak indices
might be duplicated. Note that if one of <code>xPrecursorMz</code> or <code>yPrecursorMz</code>
are <code>NA</code> or if both are the same, the results are the same as with
<code><a href='matching.html'>join()</a></code>. The function returns a <code>list</code> of two <code>integer</code> vectors with the
indices of the peaks matching peaks in the other spectrum or <code>NA</code>
otherwise.</p></li>
<li><p><code>gnps</code>: calculates the GNPS similarity score on peak matrices' previously
<em>aligned</em> (matched) with <code>join_gnps</code>. For multi-mapping peaks the pair with
the higher similarity are considered in the final score calculation.</p></li>
</ul>

    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='fu'>gnps</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='fu'>join_gnps</span><span class='op'>(</span>
  <span class='va'>x</span>,
  <span class='va'>y</span>,
  xPrecursorMz <span class='op'>=</span> <span class='cn'>NA_real_</span>,
  yPrecursorMz <span class='op'>=</span> <span class='cn'>NA_real_</span>,
  tolerance <span class='op'>=</span> <span class='fl'>0</span>,
  ppm <span class='op'>=</span> <span class='fl'>0</span>,
  type <span class='op'>=</span> <span class='st'>"outer"</span>,
  <span class='va'>...</span>
<span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>for <code>join_gnps</code>: <code>numeric</code> with m/z values from a spectrum. For
<code>gnps</code>: <code>matrix</code> with two columns <code>"mz"</code> and <code>"intensity"</code> containing
the peaks <strong>aligned</strong> with peaks in <code>y</code> (with <code>join_gnps</code>).</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>for <code>join_gnps</code>: <code>numeric</code> with m/z values from a spectrum. For
<code>gnps</code>: <code>matrix</code> with two columns <code>"mz"</code> and <code>"intensity"</code> containing
the peaks <strong>aligned</strong> with peaks in <code>x</code> (with <code>join_gnps</code>).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>for <code>join_gnps</code>: optional parameters passed to the <code><a href='matching.html'>join()</a></code>
function. For <code>gnps</code>: ignored.</p></td>
    </tr>
    <tr>
      <th>xPrecursorMz</th>
      <td><p>for <code>join_gnps</code>: <code>numeric(1)</code> with the precursor m/z
of the spectrum <code>x</code>.</p></td>
    </tr>
    <tr>
      <th>yPrecursorMz</th>
      <td><p>for <code>join_gnps</code>: <code>numeric(1)</code> with the precursor m/z
of the spectrum <code>y</code>.</p></td>
    </tr>
    <tr>
      <th>tolerance</th>
      <td><p>for <code>join_gnps</code>: <code>numeric(1)</code> defining a constant maximal
accepted difference between m/z values of peaks from the two spectra to
be matched/mapped.</p></td>
    </tr>
    <tr>
      <th>ppm</th>
      <td><p>for <code>join_gnps</code>: <code>numeric(1)</code> defining a relative, m/z-dependent,
maximal accepted difference between m/z values of peaks from the two
spectra to be matched/mapped.</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>for <code>join_gnps</code>: <code>character(1)</code> specifying the type of join that
should be performed. See <code><a href='matching.html'>join()</a></code> for details and options. Defaults to
<code>type = "outer"</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>See function definition in the description section.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The implementation of <code>gnps</code> bases on the R code from the publication listed
in the references.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Xing S, Hu Y, Yin Z, Liu M, Tang X, Fang M, Huan T. Retrieving and Utilizing
Hypothetical Neutral Losses from Tandem Mass Spectra for Spectral Similarity
Analysis and Unknown Metabolite Annotation. <em>Anal Chem.</em>
2020 Nov 3;92(21):14476-14483. doi: <a href='https://doi.org/10.1021/acs.analchem.0c02521'>10.1021/acs.analchem.0c02521</a>
.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other grouping/matching functions: 
<code><a href='binning.html'>bin</a>()</code>,
<code><a href='matching.html'>closest</a>()</code></p>
<p>Other distance/similarity functions: 
<code><a href='distance.html'>distance</a></code></p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Johannes Rainer, Michael Witting, based on the code from
Xing <em>et al.</em> (2020).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <div class="ref-examples sourceCode"><pre class='sourceCode r'><code><span class='r-in'></span>
<span class='r-in'><span class='co'>## Define spectra</span></span>
<span class='r-in'><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span>mz <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span>, <span class='fl'>36</span>, <span class='fl'>63</span>, <span class='fl'>91</span>, <span class='fl'>93</span><span class='op'>)</span>, intensity <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>14</span>, <span class='fl'>15</span>, <span class='fl'>999</span>, <span class='fl'>650</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'><span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>cbind</a></span><span class='op'>(</span>mz <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span>, <span class='fl'>12</span>, <span class='fl'>50</span>, <span class='fl'>63</span>, <span class='fl'>105</span><span class='op'>)</span>, intensity <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>35</span>, <span class='fl'>5</span>, <span class='fl'>16</span>, <span class='fl'>999</span>, <span class='fl'>450</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'><span class='co'>## The precursor m/z</span></span>
<span class='r-in'><span class='va'>pmz_x</span> <span class='op'>&lt;-</span> <span class='fl'>91</span></span>
<span class='r-in'><span class='va'>pmz_y</span> <span class='op'>&lt;-</span> <span class='fl'>105</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## Plain join identifies only 2 matching peaks</span></span>
<span class='r-in'><span class='fu'><a href='matching.html'>join</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span>, <span class='va'>y</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> $x</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1]  1 NA  2 NA  3  4  5 NA</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> $y</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1]  1  2 NA  3  4 NA NA  5</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## join_gnps finds 4 matches</span></span>
<span class='r-in'><span class='fu'>join_gnps</span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span>, <span class='va'>y</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span>, <span class='va'>pmz_x</span>, <span class='va'>pmz_y</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> $x</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>  [1]  1  2  2  3  4  4  5 NA NA NA</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> $y</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span>  [1]  1 NA  3  4 NA  5 NA  2  3  5</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## with one of the two precursor m/z being NA, the result are the same as</span></span>
<span class='r-in'><span class='co'>## with join.</span></span>
<span class='r-in'><span class='fu'>join_gnps</span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span>, <span class='va'>y</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span>, <span class='va'>pmz_x</span>, yPrecursorMz <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> $x</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1]  1 NA  2 NA  3  4  5 NA</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> $y</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1]  1  2 NA  3  4 NA NA  5</span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> </span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## Calculate GNPS similarity score:</span></span>
<span class='r-in'><span class='va'>map</span> <span class='op'>&lt;-</span> <span class='fu'>join_gnps</span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span>, <span class='va'>y</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span>, <span class='va'>pmz_x</span>, <span class='va'>pmz_y</span><span class='op'>)</span></span>
<span class='r-in'><span class='fu'>gnps</span><span class='op'>(</span><span class='va'>x</span><span class='op'>[</span><span class='va'>map</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>, <span class='op'>]</span>, <span class='va'>y</span><span class='op'>[</span><span class='va'>map</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span>, <span class='op'>]</span><span class='op'>)</span></span>
<span class='r-out co'><span class='r-pr'>#&gt;</span> [1] 0.9923501</span>
</code></pre></div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by RforMassSpectrometry Package Maintainer, Laurent Gatto, Johannes Rainer, Sebastian Gibb.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


